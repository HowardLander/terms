<!DOCTYPE html>
<html lang="en">



    <head>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>NIDM: BIDS Specification Terms</title>
        
        
        <title>NIDM: BIDS Specification Terms</title>
        <link rel="stylesheet" type="text/css" herf="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.css">
        <link rel="stylesheet" type="text/css" herf="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/css/bootstrap-select.min.css">
        <script src= "https://code.jquery.com/jquery-3.5.1.js"></script> 
        <script src="./js_lib/jquery.treeView.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/jsonld@1.0.0/dist/jsonld.min.js"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.bundle.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/js/bootstrap-select.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <script src='https://kit.fontawesome.com/a076d05399.js'></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

        <script src="https://cdn.jsdelivr.net/npm/jsonld@1.0.0/dist/jsonld.min.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/danfojs@0.1.1/dist/index.min.js"></script>
        <script src="http://code.jquery.com/jquery-1.7.1.js" type="text/javascript"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jsonld/1.0.0/jsonld.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/jsonld@1.0.0/dist/jsonld.min.js"></script>
        <script src="https://unpkg.com/jsonld@1.0.0/dist/jsonld.min.js"></script>


        
        

    </head>



    <body>

        <div class="about">
            <form action = "https://github.com/NIDM-Terms/terms" target="_blank">
                <button class= "github">Github <i class="fa fa-github" style="font-size:17px"></i>
                </button>
            </form>
            <form action = "https://scicrunch.org/nidm-terms/about/project" target="_blank">
               <button  class= "website">NIDM Website</button>
            </form>
            <form action = "http://nidm.nidash.org/" target="_blank">
                <button class = "nidmSpecs"> NIDM Specs</button>
            </form>
            <form action ="https://github.com/incf-nidash/PyNIDM" target= "_blank" >
                <button class= "pyNidm"> PyNIDM</a>
            </form>
        </div>

        <header>
            <div class= "logo">
                <img src="img/nidm-terms_576163.png" width= "85" height="85">
            </div>
            <div class="inner">
                <h>NIDM-Terms</h>
            </div>
            <div class="bidsTitle">
                <h> BIDS Specification Terms</h>
                <div class= "search-box">
                    <input id= "searchBar" class="search_bar" type="text" name="box" placeholder = "Search BIDS Terms..."><i id= "searchIcon" class="fa fa-search" style="font-size:24px"></i>
                </div>
            </div>
        </header>



        <div>
            <nav>
                <ul class= "menuUl"><center>
                    <li class= "menuLi">
                        <form action= "index.html">
                            <button class = "available_terms" type="submit">Available Terms</button>
                        </form>
                    </li>
                    <li class= "menuLi">
                        <form action= "addNewTerm.html">
                            <button class = "add_terms" type="submit">Add New Terms</button>
                        </form>
                    </li>
                    <li class= "menuLi">
                        <form action="createTable.html">
                            <button class = "createTable">Export Terms</button>
                        </form>
                    </li>
                    <li class= "menuLi">
                        <form action="info.html">
                            <button class = "resources">About</button>
                        </form> 
                    </li>
                    <center><hr id="menuLine"></center>
                </center></ul>
            </nav>
        </div>
        <center><div>
            <div>
                <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>
                <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel="stylesheet" />
                <div class="container mt-5">
                    <div class="row">
                            
                        <div class="col-md-6">
                            <div id="format" class="form-group"> <label>Select File Format</label> 
                                <br><br>
                                <select class="form-control select2 select2-hidden-accessible" multiple="" data-placeholder="  select one or more formats" style="width: 100%;" tabindex="-1" aria-hidden="true">     
                                    <option value="md">Markdown Table</option>
                                    <option value="json">JSON</option>
                                    <option value="jsonld">JSON-LD</option>
                                    <option value="rdf">RDF-Turtle</option>
                                    <option value="csv">CSV</option>
                                    <option value="yaml">YAML</option>
                                </select> </div> <!-- /.form-group -->
                        </div> <!-- /.col -->

                        <br><br><br><br>
                        
                        <div class="col-md-6">
                            <div id="properties" class="form-group"> <label>Select Term Properties</label>
                                <br><br>
                                <select class="form-control select2 select2-hidden-accessible" multiple="" data-placeholder=" select term properties" style="width: 100%;" tabindex="-1" aria-hidden="true">
                                    <option>Associated With</option>
                                    <option>Candidate Terms</option>
                                    <option>Comment</option>
                                    <option>Description</option>
                                    <option>Interlex ID</option>
                                    <option>Label</option>
                                    <option>Same AS</option>
                                    <option>Super Type CDEs</option>
                                    <option>Unit</option>
                                    <option>URL</option>
                                    <option>Was Derived From</option>
                                </select> </div> <!-- /.form-group -->
                        </div> <!-- /.col -->

                        <br><br><br><br>

                        <div class="col-md-6">
                            <div class="form-group"> <label>Select BIDS Term </label>
                                <br><br>
                                <select id = "bidsTerms" class="form-control select2 select2-hidden-accessible" multiple="" data-placeholder="  search BIDS terms" style="width: 100%;" tabindex="-1" aria-hidden="true">
                                    
                                </select> </div> <!-- /.form-group -->
                        </div> <!-- /.col -->

                        <br><br><br><br>

                        <div>
                            <button class="btn" id="downloadBtn" onclick="getFile()"> Download </button>
                        </div>
                    </div>
                </div>
            </div>
        </div></center>

        </body>

        <footer>
            <hr id = "footer">
            <p><center>This project was supported by the National Institutes of Mental Health (NIMH) grant 1RF1MH120021</center></p>
        </footer>


        <style id = "style">.treeview,
            .treeview ul {list-style-type:none;
            overflow:hidden;
            }
            .treeview li {
                text-indent:1%;
                margin-top:0.4em;
                padding:0.15em 0 0.5em 1.5em;
                line-height:22px;
                background-repeat:no-repeat;
                background-size:24px 24px;
                margin-right: 30px;
            }

        
            .treeview>li:hover {
                cursor:pointer; 
                overflow: hidden;
            }
        
            .treeview span:hover {background-color: rgba(246,246,246,0.7
            
            ); } 

            .terms{
                margin-left: -22px;
            }

            .about{
            color: #52575e;
            font-size: 14px;
            cursor: pointer;
            outline: none;
            }

        .github{
            float: right;
            padding: 20px;
            margin-right: 10px;
            margin-top: 56px;
            color: #52575e;
            font-size: 14px;
            width: 130px;
            height:50px;
        }

        .github:hover{
            color: #32e17c;
            transition: 0.1s;
        }
        
        .website{
            float: right;
            margin-top: 61px;
            color: #52575e;
            font-size: 14px;
            width: 130px;
            height:50px;
        }

        .website:hover{
            color: #32e17c;
            transition: 0.1s;
        }

        .nidmSpecs{
            float: right;
            margin-top: 61px;
            color: #52575e;
            font-size: 14px;
            width: 130px;
            height:50px;
        }

        .nidmSpecs:hover{
            color: #32e17c;
            transition: 0.1s;
        }

        .pyNidm{
            float: right;
            margin-top: 61px;
            color: #52575e;
            font-size: 14px;
            width: 130px;
            height:50px;
        }

        .pyNidm:hover{
            color: #32e17c;
            transition: 0.1s;
        }

        .fileForm{
                margin-left: 45px;
            }

            
            .properties{
                margin-left: 45px;
            }

            .inner{
                margin: 40px;
                padding-top: 20px;
                padding-left: 124px;
                font-weight:lighter;
                font-size: 30px;
                font-family: serif;
                text-transform: uppercase;
                color: #a6a6a6;
            }
            .logo{
                position: absolute;
                top: 30px;
                left: 60px;
            }

            header{
                width: 100%;

            }

            .bidsTitle{
                color: white;
                background-size: 100px;
                background-color: #52575e;
                font-size: 40px;
                text-indent: 100px;
                padding-top: 20px;
                padding-left: 60px;
                padding-bottom: 20px;
            }

            .search_bar{
                float: right;
                margin-top: -47px;
                margin-right: 50px;
                border: 2px solid #32e17c;
                height: 45px;
                width: 325px;
                border-radius: 5px;
                background-color: #fefcfb;
                font-size: 18px;
                text-indent: 44px;
                outline: none;
            } 

            #searchIcon{
                color: #828486;
                float: right;
                margin-top: -35px;
                margin-right: -38px;
            }

            body {
                background-color: #ffffff;
            }

            .menuUl{
                width: auto;
                margin-top: 70px;
            }

            .menuLi{
                display: inline-block;
                padding: 20px 10px;
            }

            button{
                width: 250px;
                height: 60px;
                background-color: transparent;
                border: transparent;
                border-radius: 0px;
                font-size: 18px;
                font-weight:bold;
                cursor: pointer;
                outline: none;
            }

            .available_terms{
                color: #EA2027;
                
            }
            .available_terms:hover{
                border: 2px solid #EA2027;
                border-radius: 5px;
            }

            .add_terms{
                color: #EE5A24;
            }
            .add_terms:hover{
                border: 2px solid #EE5A24;
                border-radius: 5px;
            }
            
            .createTable{
                color: #F79F1F;
                border: 2px solid #F79F1F;
                border-radius: 5px;
            }

            .resources{
                color: #FFC312;
            }
            .resources:hover{
                border: 2px solid #FFC312;
                border-radius: 5px;

            }

            #menuLine{
                height: 10px;
                background-image: linear-gradient(
                    to right, 
                    #EA2027, 
                    #EE5A24, 
                    #F79F1F, 
                    #FFC312
                    );
                margin-top: -23px;
                width: 1200px;
            }

            .container{
                width: 875px;
                height: 170%;
                text-align: left;
                font-family:Arial, Helvetica, sans-serif;
                border: 1px solid #b3b3b3 ;
                border-radius: 0px;
                padding: 80px;
                padding-top: 80px;
                padding-right: -10px;
                padding-bottom: 80px;
                margin-top: 50px;
                background-color: #F7F7F7 ;
                box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);

            }

            .headerBrdr{
                font-size: 30px;
                color: #7e7e7e;
                font-weight: bold;
            }
        
            .TermInput{
                height: 40px;
                width: 35%;
                border-radius: 50px;
                border-color: #7e7e7e;
                padding: 0px 20px;
                background-color: #fdfdfd;
                font-size: 18px;
                outline: none;
                font-size: 18px;
                margin-top: -25px;
                margin-bottom: 10px;
                text-indent: 25px
            }

            .inputs{
                padding-top: 20px;
            }

            h4{
                color: #52575e;
                font-weight:bold;
                font-size: 20px;
            }

            .statement{
                color:#7e7e7e;
                font-size: 14px;
                padding-top: 90px;
            }


            .btn{
                cursor: pointer;
                width: 220px;
                height: 50px;
                border-radius: 50px;
                font-size: 18px;
                background-color: #fefcfb;
                border: 2px solid #EE5A24;
                border-radius: 5px;
                font-size: 18px;
                color: #EE5A24;
                float:right;
                margin-bottom: 50px;
            }

            .btn:hover{
                color:#fefcfb;
                background-image: linear-gradient(
                to right, 
                #EE5A24, 
                #F79F1F
                );
                border: none;
            }

            .btn:active {
                -webkit-box-shadow: inset 0px 0px 5px #791316;
                    -moz-box-shadow: inset 0px 0px 5px #791316;
                        box-shadow: inset 0px 0px 5px #791316;
                outline: none;
            }
            

            .process{
                color:#7e7e7e;
                font-size: 18px;
                padding-bottom: 90px;
            }

            #footer{
            height: 3px;
            background-image: linear-gradient(
                to right, 
                #EA2027, 
                #EE5A24, 
                #F79F1F, 
                #FFC312
                );
            width: 100%; 
            margin-top: 130px
            }   

            .multi_select_box{
                width: 400px;
                margin: 80px auto;
            }

            .multi_select_box select{
                width: 100%;
            }

            .multi_select_box button{
                background-color: lightgray !important;
                color: #fff !important;
                padding: 15px 25px;
            }
            

            .form-control {
                border-radius: 0;
                box-shadow: none;
                border-color: #d2d6de
            }

            .select2-hidden-accessible {
                border: 0 !important;
                clip: rect(0 0 0 0) !important;
                height: 1px !important;
                margin: -1px !important;
                overflow: hidden !important;
                padding: 0 !important;
                position: absolute !important;
                width: 1px !important
            }

            .form-control {
                display: block;
                width: 100%;
                height: 34px;
                padding: 6px 12px;
                font-size: 14px;
                line-height: 1.42857143;
                color: #555;
                background-color: #fff;
                background-image: none;
                border: 1px solid #ccc;
                border-radius: 4px;
                -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);
                box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);
                -webkit-transition: border-color ease-in-out .15s, -webkit-box-shadow ease-in-out .15s;
                -o-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
                transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s
            }

            .select2-container--default .select2-selection--single,
            .select2-selection .select2-selection--single {
                border: 1px solid #d2d6de;
                border-radius: 0;
                padding: 6px 12px;
                height: 34px
            }

            .select2-container--default .select2-selection--single {
                background-color: #fff;
                border: 1px solid #aaa;
                border-radius: 4px
            }

            .select2-container .select2-selection--single {
                box-sizing: border-box;
                cursor: pointer;
                display: block;
                height: 28px;
                user-select: none;
                -webkit-user-select: none
            }

            .select2-container .select2-selection--single .select2-selection__rendered {
                padding-right: 10px
            }

            .select2-container .select2-selection--single .select2-selection__rendered {
                padding-left: 0;
                padding-right: 0;
                height: auto;
                margin-top: -3px
            }

            .select2-container--default .select2-selection--single .select2-selection__rendered {
                color: #444;
                line-height: 28px
            }

            .select2-container--default .select2-selection--single,
            .select2-selection .select2-selection--single {
                border: 1px solid #d2d6de;
                border-radius: 0 !important;
                padding: 6px 12px;
                height: 40px !important
            }

            .select2-container--default .select2-selection--single .select2-selection__arrow {
                height: 26px;
                position: absolute;
                top: 6px !important;
                right: 1px;
                width: 20px
            }


        
        </style>

        <script>


            /////////////////////////////////////////////
            //bootstrap dropdown list function
            $(document).ready(function() {
                $('.select2').select2({
                    closeOnSelect: false
                });
            });

            ///////////////////////////////////////////////////////////
            //function to fetch the single jsonld file
            function getFile(){
                fetch("https://raw.githubusercontent.com/nqueder/terms/master/terms/BIDS_Terms.jsonld")

                .then(function(resp){
                    return resp.json(); 
                })

                .then(function sortOnKeys(dict_data) {
                    var sorted = [];

                    dict_data['terms'].sort((a, b) => (a.label > b.label) ? 1 : (a.label === b.label) ? ((a.description > b.size) ? 1 : -1) : -1 );

                    for (var p in dict_data['terms']) {
                        sorted[sorted.length] = dict_data.terms[p].label;
                    }

                    sorted.sort();

                    var tempDict = {};

                    for(var g = 0; g < sorted.length; g++) {
                        tempDict['@context'] = dict_data['@context'];
                        tempDict['terms'] = dict_data['terms']
                    };
                    
                    return tempDict

                })

                //This function gets the form of download the user chooses
                .then(function download(jsonldData){

                    //get selected properties
                    selectedProperties = $('#properties :selected').map((_,e) => e.value).get();
                    console.log(selectedProperties)

                    //get selected terms
                    selectedTerms = $('#bidsTerms :selected').map((_,e) => e.value).get();
                    console.log(selectedTerms)
                    
                    //get selected formats
                    selectedFormats = $('#format :selected').map((_,e) => e.value).get();
                    arrayLength = selectedFormats.length;
                    console.log(selectedFormats)

                    //call formats functions
                    for(var i = 0; i < arrayLength; i++){
                        if(selectedFormats[i] == 'md'){
                            mdTable(jsonldData,selectedProperties,selectedTerms)
                        };
                        if(selectedFormats[i] == 'json'){
                            getJson(jsonldData,selectedProperties,selectedTerms)
                        };
                        if(selectedFormats[i] == 'jsonld'){
                            getjsonld(jsonldData,selectedProperties,selectedTerms)
                        };
                        if(selectedFormats[i] == 'rdf'){
                            rdf(jsonldData,selectedProperties,selectedTerms)
                        };
                        if(selectedFormats[i] == 'csv'){
                            csv(jsonldData,selectedProperties,selectedTerms)
                        };
                        if(selectedFormats[i] == 'yaml'){
                            yaml(jsonldData,selectedProperties,selectedTerms)
                        };
                    }
                })
            }
            
            //This function exports a Mark down Table of the choosen terms
            function mdTable(jsonldData,selectedProperties,selectedTerms){
                console.log('mdTable is working')

                rowDiv = '--------------';
                colDiv = '|'

                buildRows = "|          ";

                //get the selected properties
                selectedPropertiesLength = selectedProperties.length;
                for(p = 0; p < selectedPropertiesLength; p++){

                    buildRows += "| " + selectedProperties[p];

                }

                buildRows += colDiv
                buildRows += "\n"
                buildRows += colDiv + rowDiv + colDiv

                for(l = 0; l < selectedPropertiesLength; l++){
                    buildRows += rowDiv +colDiv
                } 
                
                buildRows += "\n"
                buildRows += colDiv

                for (var l in jsonldData['terms']) {
                        
                    //for every term selected get the selected properties of that term
                    selectedTermsLength = selectedTerms.length;
                    for(t = 0; t < selectedTermsLength; t++){
                        
                        if(selectedTerms[t].toLowerCase() == jsonldData.terms[l].label.toLowerCase()){

                            buildRows += jsonldData.terms[l].label + colDiv 

                            for(tp = 0; tp < selectedPropertiesLength; tp++){
                                if(selectedProperties[tp] == "Associated With"){
                                    if('associatedWith' in jsonldData.terms[l]){
                                        buildRows += " NIDM, BIDS" + colDiv
                                    } else{
                                        buildRows += "         " + colDiv
                                    }
                                }
                                if(selectedProperties[tp] == "Candidate Terms"){
                                    if('candidateTerms' in jsonldData.terms[l]){
                                        buildRows += jsonldData.terms[l].candidateTerms + colDiv
                                    } else{
                                        buildRows += "         " + colDiv
                                    }
                                }
                                if(selectedProperties[tp] == "Comment"){
                                    if('comment' in jsonldData.terms[l]){
                                        buildRows += jsonldData.terms[l].comment + colDiv
                                    } else{
                                        buildRows += "         " + colDiv
                                    }
                                }
                                if(selectedProperties[tp] == "Description"){
                                    if('description' in jsonldData.terms[l]){
                                        buildRows += jsonldData.terms[l].description + colDiv
                                    } else{
                                        buildRows += "         " + colDiv
                                    }
                                }
                                if(selectedProperties[tp] == "Interlex ID"){
                                    if('ilxId' in jsonldData.terms[l]){
                                        buildRows += jsonldData.terms[l].ilxId + colDiv
                                    } else{
                                        buildRows += "         " + colDiv
                                    }
                                }
                                if(selectedProperties[tp] == "Same As"){    
                                    if('sameAs' in jsonldData.terms[l]){
                                        buildRows += jsonldData.terms[l].sameAs + colDiv
                                    } else{
                                        buildRows += "         " + colDiv
                                    }
                                }
                                if(selectedProperties[tp] == "Super Type CDEs"){
                                    if('supertypeCDEs' in jsonldData.terms[l]){
                                        buildRows += jsonldData.terms[l].supertypeCDEs + colDiv
                                    } else{
                                        buildRows += "         " + colDiv
                                    }
                                }
                                if(selectedProperties[tp] == "Unit"){
                                    if('unit' in jsonldData.terms[l]){
                                        buildRows += jsonldData.terms[l].unit + colDiv
                                    } else{
                                        buildRows += "         " + colDiv
                                    }
                                }
                                if(selectedProperties[tp] == "URL"){
                                    if('url' in jsonldData.terms[l]){
                                        buildRows += jsonldData.terms[l].url + colDiv
                                    } else{
                                        buildRows += "         " + colDiv
                                    }
                                }
                                if(selectedProperties[tp] == "Was Derived From"){
                                    if('wasDerivedFrom' in jsonldData.terms[l]){
                                        buildRows += jsonldData.terms[l].wasDerivedFrom + colDiv
                                    } else{
                                        buildRows += "         " + colDiv
                                    }
                                }

                            }

                            buildRows += "\n"

                        }
                    }
                    

                }      

                downloadObjectAsJson(buildRows, "BIDS_Terms_MD_Table")

                function downloadObjectAsJson(exportObj, exportName){
                    var dataStr = "data:text/md;charset=utf-8," + encodeURIComponent(exportObj);
                    var downloadAnchorNode = document.createElement('a');
                    downloadAnchorNode.setAttribute("href",     dataStr);
                    downloadAnchorNode.setAttribute("download", exportName + ".md");
                    document.body.appendChild(downloadAnchorNode); // required for firefox
                    downloadAnchorNode.click();
                    downloadAnchorNode.remove();
                }

            }

            //This function exports json formatted file 
            function getJson(jsonldData,selectedProperties,selectedTerms){
                jsonDict = {};

                for (var l in jsonldData['terms']) {

                    //for every term selected get the selected properties of that term
                    selectedTermsLength = selectedTerms.length;
                    for(t = 0; t < selectedTermsLength; t++){
                        if(selectedTerms[t].toLowerCase() == jsonldData.terms[l].label.toLowerCase()){
                            temp = {};

                            //get the selected properties
                            selectedPropertiesLength = selectedProperties.length;
                            for(p = 0; p < selectedTermsLength; p++){
                                temp['label'] = jsonldData.terms[l].label
                                temp['associatedWith'] = ["NIDM","BIDS"]
        
                                if('candidateTerms' in jsonldData.terms[l]){
                                    if(selectedProperties[p] == "Candidate Terms"){
                                        temp['candidateTerms'] = jsonldData.terms[l].candidateTerms
                                    }
                                }
                                if('comment' in jsonldData.terms[l]){
                                    if(selectedProperties[p] == "Comment"){
                                        temp['comment'] = jsonldData.terms[l].comment
                                    }
                                }
                                if('description' in jsonldData.terms[l]){
                                    if(selectedProperties[p] == "Description"){
                                        temp['description'] = jsonldData.terms[l].description
                                    }
                                }
                                if('ilxId' in jsonldData.terms[l]){
                                    if(selectedProperties[p] == "Interlex ID"){
                                        temp['ilxId'] = jsonldData.terms[l].ilxId
                                    }
                                }
                                    
                                if('sameAs' in jsonldData.terms[l]){
                                    if(selectedProperties[p] == "Same As"){
                                        temp['sameAs'] = jsonldData.terms[l].sameAs
                                    }
                                }
                                if('supertypeCDEs' in jsonldData.terms[l]){
                                    if(selectedProperties[p] == "Super Type CDEs"){
                                        temp['supertypeCDEs'] = jsonldData.terms[l].supertypeCDEs
                                    }
                                }
                                if('unit' in jsonldData.terms[l]){
                                    if(selectedProperties[p] == "Unit"){
                                        temp['unit'] = jsonldData.terms[l].unit
                                    }
                                }
                                if('url' in jsonldData.terms[l]){
                                    if(selectedProperties[p] == "URL"){
                                        temp['url'] = jsonldData.terms[l].url
                                    }
                                }
                                if('wasDerivedFrom' in jsonldData.terms[l]){
                                    if(selectedProperties[p] == "Was Derived From"){
                                        temp['wasDerivedFrom'] = jsonldData.terms[l].wasDerivedFrom
                                    }
                                }
                            };

                            jsonDict[jsonldData.terms[l].label] = temp
                        }
                    }
                }

                downloadObjectAsJson(jsonDict, "BIDS_Terms")

                function downloadObjectAsJson(exportObj, exportName){
                    var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(exportObj));
                    var downloadAnchorNode = document.createElement('a');
                    downloadAnchorNode.setAttribute("href",     dataStr);
                    downloadAnchorNode.setAttribute("download", exportName + ".json");
                    document.body.appendChild(downloadAnchorNode); // required for firefox
                    downloadAnchorNode.click();
                    downloadAnchorNode.remove();
                }
                
            }

            function getjsonld(jsonldData,selectedProperties,selectedTerms){

                //get the context file
                fetch("https://raw.githubusercontent.com/NIDM-Terms/terms/master/context/cde_context.jsonld")

                .then(function(resp){
                    return resp.json(); 
                })

                .then(async function  getDict(context){

                    for (var l in jsonldData['terms']) {

                        //for every term selected get the selected properties of that term
                        selectedTermsLength = selectedTerms.length;
                        for(t = 0; t < selectedTermsLength; t++){
                            if(selectedTerms[t].toLowerCase() == jsonldData.terms[l].label.toLowerCase()){
                                temp = {};

                                temp['@context'] = 'https://raw.githubusercontent.com/NIDM-Terms/terms/master/context/cde_context.jsonld';
                                temp['@type'] = 'DataElement';
                                temp[context['@context']['associatedWith']] = ["NIDM","BIDS"];

                                //get the selected properties
                                selectedPropertiesLength = selectedProperties.length;
                                for(p = 0; p < selectedTermsLength; p++){
                                    
                                    temp[context['@context']['label']] = jsonldData.terms[l].label;

                                    if('candidateTerms' in jsonldData.terms[l]){
                                        if(selectedProperties[p] == "Candidate Terms"){
                                            temp[context['@context']['candidateTerms']] = jsonldData.terms[l].candidateTerms
                                        }
                                    }
                                    if('comment' in jsonldData.terms[l]){
                                        if(selectedProperties[p] == "Comment"){
                                            temp[context['@context']['comment']] = jsonldData.terms[l].comment
                                        }
                                    }
                                    if('description' in jsonldData.terms[l]){
                                        if(selectedProperties[p] == "Description"){
                                            temp[context['@context']['description']] = jsonldData.terms[l].description
                                        }
                                    }
                                    if('ilxId' in jsonldData.terms[l]){
                                        if(selectedProperties[p] == "Interlex ID"){
                                            temp[context['@context']['ilxId']] = jsonldData.terms[l].ilxId
                                        }
                                    }
                                    if('sameAs' in jsonldData.terms[l]){
                                        if(selectedProperties[p] == "Same As"){
                                            temp[context['@context']['sameAs']] = jsonldData.terms[l].sameAs
                                        }
                                    }
                                    if('supertypeCDEs' in jsonldData.terms[l]){
                                        if(selectedProperties[p] == "Super Type CDEs"){
                                            temp[context['@context']['supertypeCDEs']] = jsonldData.terms[l].supertypeCDEs
                                        }
                                    }
                                    if('unit' in jsonldData.terms[l]){
                                        if(selectedProperties[p] == "Unit"){
                                            temp[context['@context']['unit']] = jsonldData.terms[l].unit
                                        }
                                    }
                                    if('url' in jsonldData.terms[l]){
                                        if(selectedProperties[p] == "URL"){
                                            temp[context['@context']['url']] = jsonldData.terms[l].url
                                        }
                                    }
                                    if('wasDerivedFrom' in jsonldData.terms[l]){
                                        if(selectedProperties[p] == "Was Derived From"){
                                            temp[context['@context']['wasDerivedFrom']] = jsonldData.terms[l].wasDerivedFrom
                                        }
                                    }
                                };

                                console.log(temp)
                                //compact term dictionary
                                const compacted = await jsonld.compact(temp, 'https://raw.githubusercontent.com/NIDM-Terms/terms/master/context/cde_context.jsonld');

                                downloadObjectAsJson(compacted, jsonldData.terms[l].label)

                                function downloadObjectAsJson(exportObj, exportName){
                                    var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(exportObj));
                                    var downloadAnchorNode = document.createElement('a');
                                    downloadAnchorNode.setAttribute("href",     dataStr);
                                    downloadAnchorNode.setAttribute("download", exportName + ".jsonld");
                                    document.body.appendChild(downloadAnchorNode); // required for firefox
                                    downloadAnchorNode.click();
                                    downloadAnchorNode.remove();
                                }

                            }
                        }
                    }
                }) 
            }

            function rdf(jsonldData,selectedProperties,selectedTerms){
                console.log('rdf is working')
            }

            function csv(jsonldData,selectedProperties,selectedTerms){
                console.log('csv is working')
                table = [];

                //get terms and properties
                for (var l in jsonldData['terms']) {

                    //for every term selected get the selected properties of that term
                    selectedTermsLength = selectedTerms.length;
                    for(t = 0; t < selectedTermsLength; t++){
                        if(selectedTerms[t].toLowerCase() == jsonldData.terms[l].label.toLowerCase()){
                            temp = {};

                            //get the selected properties
                            selectedPropertiesLength = selectedProperties.length;
                            for(p = 0; p < selectedPropertiesLength; p++){
                                temp['label'] = jsonldData.terms[l].label

                                
                                if (selectedProperties[p] == "Associated With"){
                                    temp['associatedWith'] = ['BIDS', 'NIDM']
                                } 
                                if(selectedProperties[p] == "Candidate Terms"){
                                    if('candidateTerms' in jsonldData.terms[l]){
                                        temp['candidateTerms'] = jsonldData.terms[l].candidateTerms
                                    } else {
                                    temp['candidateTerms'] = ''
                                }
                                } 
                                if(selectedProperties[p] == "Comment"){
                                    if('comment' in jsonldData.terms[l]){
                                        temp['comment'] = jsonldData.terms[l].comment
                                    } else {
                                        temp['comment'] = ''
                                    }
                                } 
                                if(selectedProperties[p] == "Description"){
                                    if('description' in jsonldData.terms[l]){
                                        temp['description'] = jsonldData.terms[l].description
                                    } else {
                                        temp['description'] = ''
                                    }
                                } 
                                if(selectedProperties[p] == "Interlex ID"){
                                    if('ilxId' in jsonldData.terms[l]){
                                        temp['ilxId'] = jsonldData.terms[l].ilxId
                                    } else {
                                        temp['ilxId'] = ''
                                    } 
                                } 
                                if(selectedProperties[p] == "Same As"){
                                    if('sameAs' in jsonldData.terms[l]){
                                        temp['sameAs'] = jsonldData.terms[l].sameAs
                                    } else {
                                        temp['sameAs'] = ''
                                    }
                                } 
                                if(selectedProperties[p] == "Super Type CDEs"){
                                    if('supertypeCDEs' in jsonldData.terms[l]){
                                        temp['supertypeCDEs'] = jsonldData.terms[l].supertypeCDEs
                                    } else {
                                        temp['supertypeCDEs'] = ''
                                    }
                                } 
                                if(selectedProperties[p] == "Unit"){
                                    if('unit' in jsonldData.terms[l]){
                                        temp['unit'] = jsonldData.terms[l].unit
                                    } else {
                                        temp['unit'] = ''
                                    }
                                } 
                                if(selectedProperties[p] == "URL"){
                                    if('url' in jsonldData.terms[l]){
                                        temp['url'] = jsonldData.terms[l].url
                                    } else {
                                        temp['url'] = ''
                                    }
                                } 
                                if(selectedProperties[p] == "Was Derived From"){
                                    if('wasDerivedFrom' in jsonldData.terms[l]){
                                        temp['wasDerivedFrom'] = jsonldData.terms[l].wasDerivedFrom
                                    } else {
                                        temp['wasDerivedFrom'] = ''
                                    }
                                } 
                            };

                            //add temp dictionary to table to build the dataframe
                            table.push(temp);
                        }
                    }
                }

                // Convert Object to JSON
                var jsonObject = JSON.stringify(table);

                //ConvertToCSV(jsonObject)

                function ConvertToCSV(objArray) {
                    const array = typeof objArray !== 'object' ? JSON.parse(objArray) : objArray;
                    let str = `${Object.keys(array[0]).map(value => `"${value}"`).join(",")}` + '\r\n';

                    return array.reduce((str, next) => {
                        str += `${Object.values(next).map(value => `"${value}"`).join(",")}` + '\r\n';
                        return str;
                        }, str);
                };

                var blob = new Blob([ConvertToCSV(jsonObject)], { type: 'text/csv;charset=utf-8;' });
                var link = document.createElement("a");
                if (link.download !== undefined) { // feature detection
                    // Browsers that support HTML5 download attribute
                    var url = URL.createObjectURL(blob);
                    link.setAttribute("href", url);
                    link.setAttribute("download", "BIDS_Terms");
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                };

            };

            function yaml(jsonldData,selectedProperties,selectedTerms){
                console.log('yaml is working')
            }


            /////////////////////////////////////////////
            // dosplay and main function
            $(document).ready(function(event) {

                fetch("https://raw.githubusercontent.com/nqueder/terms/master/terms/BIDS_Terms.jsonld")

                .then(function(resp){
                    return resp.json(); 
                })

                .then(function sortOnKeys(dict_data) {
                    var sorted = [];

                    dict_data['terms'].sort((a, b) => (a.label > b.label) ? 1 : (a.label === b.label) ? ((a.description > b.size) ? 1 : -1) : -1 );

                    for (var p in dict_data['terms']) {
                        sorted[sorted.length] = dict_data.terms[p].label;
                    }

                    sorted.sort();

                    var tempDict = {};

                    for(var g = 0; g < sorted.length; g++) {
                        tempDict['@context'] = dict_data['@context'];
                        tempDict['terms'] = dict_data['terms']
                    };

                    return tempDict

                })

                .then(function(data){


                    //Get search input and pass the search
                    const searchBar = document.getElementById("searchBar");

                    console.log(searchBar)
                    searchBar.addEventListener("keyup", (e) => {
                        const searchString = e.target.value;

                        const searchedTerms = filterTerms(data, searchString);

                        if(isEmpty(searchedTerms)){
                            document.getElementById('termsView').innerHTML = ''
                            doc = '<div style= "color:#52575e;font-size:24px;font-weight:bold;"> NO MATCHING TERMS HAVE BEEN FOUND... </div>'
                            $('#termsView').append(doc);
                            return;
                        }

                        displayTerms(searchedTerms)

                        //console.log(searchedTerms);

                        //return searchedTerms

                    });

                    displayTerms(data) 

                    //Function to display the terms in a treeview
                    function displayTerms(data) {

                        //Clear previous term display
                        document.getElementById('bidsTerms').innerHTML = "";

                        var html = '';

                        
                        
                        for (var l in data['terms']) { // Each sub-entry

                            html += '<option>' + data.terms[l].label +'</option>';
                            
                        }
                        
                        $('#bidsTerms').append(html);

                    };

                    // this function filters the data dictionary based on the input of the search bar
                    function filterTerms(data, searchedTerms){
                        
                        var results = {};
                        var termsDict = {};
                        var termsList = [];

                        for (var l in data['terms']){
                            $.each(data.terms[l], function (key, value) {

                                if(key == 'label' & data.terms[l].label.toLowerCase().includes(searchedTerms.toLowerCase())){
                                    termsDict = data.terms[l] 
                                    termsList.push(termsDict)  
                                };
                                
                            }); 

                        };
                        
                        results['@context'] = 'https://raw.githubusercontent.com/nqueder/terms/master/context/cde_context.jsonld';
                        results['terms'] = termsList
                        
                        return results

                    };

                    // This function checks if the dictionary is empty
                    function isEmpty(obj) {                
                        for(var key in obj) {
                            if(obj.hasOwnProperty(key))
                                return false;
                        }
                        return true;
                    };
                    


                });

            });

        </script>

        
     
</html>